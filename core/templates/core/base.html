{% load static %}
<!doctype html>
<html lang="ru" data-bs-theme="light">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}Портал стипендиатов{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://unpkg.com/htmx.org@1.9.12"></script>
    <link href="{% static 'css/app.css' %}" rel="stylesheet">
    {% block extra_head %}{% endblock %}
</head>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<body>
{% include 'core/_topbar.html' %}
<div class="container-fluid">
    <div class="row">
        {% if user.is_authenticated %}
            <aside class="col-12 col-lg-3 col-xl-2 d-print-none">
                {% include 'core/_sidebar.html' %}
            </aside>
        {% endif %}

        <main class="py-4 {% if user.is_authenticated %}col-12 col-lg-9 col-xl-10{% else %}col-12{% endif %}">
            {% block content %}{% endblock %}
        </main>
    </div>
</div>
{% block extra_js %}

{% endblock %}

<script>
    document.addEventListener("notif-read", decrementBadge);
    document.addEventListener("notif-read-all", () => setBadge(0));

    function decrementBadge() {
        const b = document.getElementById("notif-badge");
        if (!b) return;
        const n = parseInt(b.textContent.trim(), 10);
        if (isNaN(n)) return;
        setBadge(Math.max(0, n - 1));
    }

    function setBadge(val) {
        const b = document.getElementById("notif-badge");
        if (!b) return;
        if (val <= 0) {
            b.remove();
        } else {
            b.textContent = String(val);
        }
    }

    // CSRF для HTMX
    document.addEventListener("htmx:configRequest", (e) => {
        const m = document.cookie.match(/csrftoken=([^;]+)/);
        if (m) e.detail.headers["X-CSRFToken"] = m[1];
    });
</script>
</body>
</html>